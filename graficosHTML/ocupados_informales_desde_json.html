<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ocupados Informales en Los Ríos (2017-2024) - Desde JSON Notebook</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
    body { font-family: 'Georgia', serif; margin: 0; padding: 20px; background: #f8fafc; }
        .container { max-width: 1300px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,.08); }
        h1 { margin: 0 0 10px 0; color: #1e293b; font-size: 22px; }
        p.desc { margin: 4px 0 16px 0; color: #475569; }
    .econ-underline { width: 100%; height: 3px; background: #e3120b; border-radius: 2px; margin: 6px 0 10px; }
    #chart { width: 100%; height: clamp(320px, 55vh, 720px); }
        .meta { color: #475569; font-size: 12px; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="container">
    <h1>Ocupados Informales en Los Ríos (2017-2024)</h1>
    <p class="desc">Serie temporal replicada 1:1 desde los datos exportados por el notebook.</p>
    <div class="econ-underline" aria-hidden="true"></div>
        <div id="chart"></div>
        <div class="meta" id="meta"></div>
    </div>

    <script>
        async function main() {
            try {
                const resp = await fetch('./data/ocupados_informales.json', { cache: 'no-store' });
                if (!resp.ok) throw new Error('No se pudo cargar el JSON: ' + resp.status);
                const data = await resp.json();

                const trace = {
                    x: data.trimestres,
                    y: data.valores,
                    mode: 'lines+markers',
                    name: data.label,
                    line: { color: data.color, width: 3 },
                    marker: { color: data.color, size: 6 },
                    hovertemplate: '<b>%{x}</b><br>' + data.label + ': %{y:,.0f}<extra></extra>'
                };

                const layout = {
                    title: {
                        text: '<b>Ocupados Informales en Los Ríos (2017-2024)</b><br><sub>Número de personas ocupadas en empleos informales por trimestre</sub>',
                        x: 0,
                        font: { size: 20, family: 'Georgia, serif', color: '#1e293b' }
                    },
                    font: { family: 'Georgia, serif', color: '#1e293b' },
                    legend: { font: { family: 'Georgia, serif' } },
                    plot_bgcolor: 'white',
                    paper_bgcolor: 'white',
                    xaxis: {
                        title: '',
                        showgrid: false,
                        tickfont: { family: 'Georgia, serif', size: 12 },
                        linecolor: '#d1d5db',
                        tickcolor: '#d1d5db',
                        tickmode: 'array',
                        tickvals: data.tickvals,
                        ticktext: data.ticktext,
                        range: [data.tickvals[0], data.tickvals[data.tickvals.length - 1]]
                    },
                    yaxis: {
                        title: '',
                        showgrid: true,
                        gridcolor: '#f3f4f6',
                        gridwidth: 1,
                        tickfont: { family: 'Georgia, serif', size: 12 },
                        linecolor: '#d1d5db',
                        tickcolor: '#d1d5db',
                        tickformat: ',',
                        zeroline: false
                    },
                    autosize: true,
                    margin: { l: 20, r: 120, t: 100, b: 60 },
                    height: document.getElementById('chart').clientHeight
                };

                Plotly.newPlot('chart', [trace], layout, { displaylogo: false, responsive: true });

                const meta = document.getElementById('meta');
                meta.textContent = `Períodos: ${data.total_periodos} | Primer: ${data.trimestres[0]} = ${data.valores[0].toLocaleString('es-CL')} | Último: ${data.trimestres[data.trimestres.length-1]} = ${data.valores[data.valores.length-1].toLocaleString('es-CL')}`;
            } catch (err) {
                console.error(err);
                document.getElementById('meta').textContent = 'Error cargando datos: ' + err.message;
            }
        }
        main();
    </script>
</body>
</html>
