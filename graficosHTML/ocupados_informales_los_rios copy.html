<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ocupados informales por nivel educativo y sexo — Los Ríos</title>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <style>
    :root {
      --bg: #ffffff;
      --txt: #1e293b; /* slate-800 */
      --grid: #e2e8f0; /* slate-200 */
      --axis: #cbd5e1; /* slate-300 */
      --econ-red: #e3120b; /* The Economist red */
    }
    body { margin: 0; font-family: Georgia, serif; color: var(--txt); background: var(--bg); }
    header { max-width: 1300px; margin: 24px auto 8px; padding: 0 16px; }
    h1 { font-size: 22px; font-weight: 600; margin: 0 0 4px 0; }
    .sub { font-size: 14px; color: #475569; margin-bottom: 12px; }
    #chart { width: 100%; max-width: 1300px; height: clamp(340px, 60vh, 800px); margin: 0 auto; padding: 0 8px 24px; }
    .note { max-width: 1100px; margin: 8px auto 24px; padding: 0 16px; font-size: 12px; color: #64748b; }
    /* Economist-style underline */
    .econ-underline { width: 100%; height: 3px; background: var(--econ-red); border-radius: 2px; margin-top: 6px; }
  </style>
  <!-- Simple polyfill for String.prototype.replaceAll on older browsers -->
  <script>
    if (!String.prototype.replaceAll) {
      String.prototype.replaceAll = function (search, replacement) {
        return this.split(search).join(replacement);
      };
    }
  </script>
</head>
<body>
  <header style="display: none;">
    <h1><strong>Ocupados informales por nivel educativo y sexo (2024)</strong></h1>
    <div class="sub" id="subtitle">Distribución de trabajadores informales según formación académica en Los Ríos</div>
  </header>
  <div id="chart"></div>
  

  <script>
    const DATA_URL = 'data/ocupados_informales_edu_sexo_los_rios.json';
    const EDU_ORDER = [
      'Sin educación','Básica incompleta','Básica completa',
      'Media incompleta','Media completa','Superior incompleta','Superior completa'
    ];
  // Paleta sobria tipo The Economist
  const COLORS = { 'Hombres': '#1f4e79', 'Mujeres': '#b6465f' };

    fetch(DATA_URL)
      .then(r => {
        if (!r.ok) throw new Error('No se pudo cargar el JSON: ' + DATA_URL);
        return r.json();
      })
      .then(data => {
        // No modificar el subtítulo ya que está fijo en el HTML

        const records = Array.isArray(data.records) ? data.records : [];
        // Construir vectores por sexo siguiendo EDU_ORDER.
        const yH = [], yM = [];
        for (const lvl of EDU_ORDER) {
          const recH = records.find(d => d.nivel_educativo === lvl && d.sexo === 'Hombres');
          const recM = records.find(d => d.nivel_educativo === lvl && d.sexo === 'Mujeres');
          yH.push(recH ? +recH.ocupados_informales : 0);
          yM.push(recM ? +recM.ocupados_informales : 0);
        }

        const traceH = {
          x: EDU_ORDER,
          y: yH,
          type: 'bar',
          name: 'Hombres',
          marker: {
            color: COLORS['Hombres'],
            line: { width: 0.4, color: '#94a3b8' }
          },
          opacity: 1.0,
          hovertemplate: '%{x}<br>%{y:,d} personas<extra>Hombres</extra>'
        };
        const traceM = {
          x: EDU_ORDER,
          y: yM,
          type: 'bar',
          name: 'Mujeres',
          marker: {
            color: COLORS['Mujeres'],
            line: { width: 0.4, color: '#94a3b8' }
          },
          opacity: 1.0,
          hovertemplate: '%{x}<br>%{y:,d} personas<extra>Mujeres</extra>'
        };

        const container = document.getElementById('chart');
        const isMobile = window.innerWidth <= 640;
        const layout = {
          title: { text: '' },
          barmode: 'group',
          bargap: 0.2,
          bargroupgap: 0.1,
          plot_bgcolor: 'white', paper_bgcolor: 'white', autosize: true,
          font: { family: 'Georgia, serif', color: '#1e293b', size: isMobile ? 11 : 12 },
          margin: { t: isMobile ? 84 : 100, r: isMobile ? 12 : 24, b: isMobile ? 48 : 64, l: isMobile ? 48 : 64 },
          annotations: [
            // Título principal
            {
              text: '<b>Ocupados informales por nivel educativo y sexo (2024)</b>',
              x: isMobile ? -0.04 : -0.05,
              y: isMobile ? 1.12 : 1.2,
              xref: 'paper', yref: 'paper',
              xanchor: 'left', yanchor: 'top',
              font: { family: 'Georgia, serif', size: isMobile ? 14 : 16, color: '#2c3e50' },
              showarrow: false,
              bgcolor: 'rgba(255,255,255,0.8)',
              bordercolor: '#e2e8f0',
              borderwidth: 1
            },
            // Subtítulo
            {
              text: 'Distribución de trabajadores informales según formación académica en Los Ríos',
              x: isMobile ? -0.04 : -0.05,
              y: isMobile ? 1.06 : 1.13,
              xref: 'paper', yref: 'paper',
              xanchor: 'left', yanchor: 'top',
              font: { family: 'Georgia, serif', size: isMobile ? 12 : 12, color: '#666' },
              showarrow: false
            }
          ],
          xaxis: {
            title: { text: 'Nivel educativo' }, 
            categoryorder: 'array',
            categoryarray: EDU_ORDER,
            showgrid: false,
            linecolor: '#cbd5e1',
            tickfont: { family: 'Georgia, serif' }
          },
          yaxis: {
            title: { text: 'Ocupados informales (personas)' },
            rangemode: 'tozero',
            gridcolor: '#e2e8f0',
            gridwidth: 0.6,
            tickformat: ',d',
            linecolor: '#cbd5e1',
            tickfont: { family: 'Georgia, serif', size: isMobile ? 10 : 12 }
          },
          legend: { orientation: 'h', x: 0.02, y: -0.18 },
          height: Math.max(340, Math.min(window.innerHeight * 0.6, 760))
        };

        const config = { responsive: true, displaylogo: false, modeBarButtonsToRemove: ['select2d','lasso2d'] };
        Plotly.newPlot('chart', [traceH, traceM], layout, config);
      })
      .catch(err => {
        const el = document.getElementById('chart');
        el.innerHTML = `<div style="color:#b91c1c">Error: ${String(err).replaceAll('<','&lt;')}</div>`;
        console.error(err);
      });
  </script>
</body>
</html>